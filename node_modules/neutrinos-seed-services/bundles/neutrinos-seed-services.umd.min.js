!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("platform"),require("@angular/core"),require("ngforage"),require("rxjs/Subject"),require("firebase"),require("@angular/common/http"),require("rxjs/add/operator/map"),require("@angular/router"),require("rxjs/Observable"),require("rxjs/Rx"),require("@angular/common"),require("@angular/http")):"function"==typeof define&&define.amd?define("neutrinos-seed-services",["exports","platform","@angular/core","ngforage","rxjs/Subject","firebase","@angular/common/http","rxjs/add/operator/map","@angular/router","rxjs/Observable","rxjs/Rx","@angular/common","@angular/http"],t):t(e["neutrinos-seed-services"]={},null,e.ng.core,e.ngforage,e.rxjs.Subject,e.firebase,e.ng.common.http,e.rxjs["add/operator/map"],e.ng.router,e.rxjs.Observable,e.rxjs.Rx,e.ng.common,e.ng.http)}(this,function(e,r,i,t,o,n,s,a,c,u,p,h,l){"use strict";var d=function(){function t(){this._deviceType=this.checkDevice()}return t.getInstance=function(){return this.instance||(this.instance=new t),this.instance},t.prototype.checkDevice=function(){return!window.device||"browser"==window.device.platform&&"Browser"==window.device.platform?!window.device||"browser"!=window.device.platform&&"Browser"!=window.device.platform?"browser":"cordova_browser":"mobile"},Object.defineProperty(t.prototype,"deviceType",{get:function(){return this._deviceType},enumerable:!0,configurable:!0}),t.prototype.getVal=function(e){return t.envProperties||(t.envProperties=window.neutrinos.environments,this.properties=t.envProperties.properties),"properties"==e?t.envProperties?t.envProperties.properties:undefined:t.envProperties&&t.envProperties.properties?t.envProperties.properties[e]:undefined},t.prototype.isAndroid=function(){return!(!window.device||"Android"!=window.device.platform)},t.prototype.isIOS=function(){return!(!window.device||"iOS"!=window.device.platform)},t.prototype.getAndroidVersion=function(){return this.isAndroid()?window.device.version:""},t.prototype.getAuthUrl=function(){return this.properties.baseUrl+this.properties.tenantName+"/auth/"},t.prototype.getTenantUrl=function(){return this.properties.baseUrl+this.properties.tenantName+"/"},t.prototype.getAppUrl=function(){return this.properties.baseUrl+this.properties.tenantName+"/proxy/"+this.properties.appName+"/"},t.prototype.getProxyUrl=function(){return this.properties.baseUrl+this.properties.tenantName+"/proxy/"},t.prototype.getDataModelUrl=function(){return this.properties.baseUrl+this.properties.tenantName+"/datamodel/"+this.properties.appDataSource+"/"+this.properties.appName+"/"},t.prototype.getFileIOUrl=function(){return this.properties.baseUrl+this.properties.tenantName+"/fileio/"+this.properties.appDataSource+"/"+this.properties.appName+"/"},t.prototype.getPlatformDetails=function(e){var t={platform:r.os.family,platformVersion:r.os.version};return"browser"===e?Object.assign(t,{type:"browser",browser:r.name,browserVersion:r.version}):"mobile"===e||"cordova_browser"===e?Object.assign(t,{type:"mobile",model:window.device.model,manufacturer:window.device.manufacturer,isVirtual:window.device.isVirtual}):void 0},t}(),f=function(){function n(){n.sessionStorageCache=sessionStorage}return n.prototype.getSessionStorage=function(){return n.sessionStorageCache},n.prototype.setValue=function(e,t){n.sessionStorageCache[e]=t,sessionStorage.setItem(e,t)},n.prototype.getValue=function(e){if(!n.sessionStorageCache[e])return null;try{var t=n.sessionStorageCache[e];return JSON.parse(t)}catch(r){return n.sessionStorageCache[e]}},n.prototype.remove=function(e){n.sessionStorageCache.hasOwnProperty(e)&&(delete n.sessionStorageCache[e],sessionStorage.removeItem(e))},n.prototype.clearSessionStorage=function(){n.sessionStorageCache={},sessionStorage.clear()},n.sessionStorageCache={},n.decorators=[{type:i.Injectable}],n.ctorParameters=function(){return[]},n}(),g=function(){function e(){}return e.prototype.generateUUID=function(){return this.__s4()+this.__s4()+"-"+this.__s4()+"-"+this.__s4()+"-"+this.__s4()+"-"+this.__s4()+this.__s4()+this.__s4()},e.prototype.__s4=function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)},e}(),v=function(){function e(e,t,r){this.ngfConfig=e,this.ngf=t,this.ngfCache=r,this.storageCache={}}return e.prototype.initStorage=function(){var n=this;return new Promise(function(t,r){window.cordova&&n.initNgForage(),n.ngf.iterate(function(e,t,r){n.storageCache[t]=e}).then(function(e){return n.checkDeviceId(),t("iteration is completed")})["catch"](function(e){return r(e)})})},e.prototype.getStorage=function(){return this.storageCache},e.prototype.setValue=function(e,t){return window.cordova&&this.initNgForage(),this.storageCache[e]=t,this.ngf.setItem(e,t).then(function(e){return e},function(e){console.log(e)})},e.prototype.getValue=function(e){if(!this.storageCache[e])return null;try{var t=this.storageCache[e];return JSON.parse(t)}catch(r){return this.storageCache[e]}},e.prototype.remove=function(t){var r=this;delete this.storageCache[t],window.cordova&&this.initNgForage(),this.ngf.removeItem(t).then(function(e){delete r.ngf[t]})["catch"](function(e){console.error("Could not remove",t)})},e.prototype.clear=function(){this.storageCache={},this.ngf.clear()},e.prototype.pluginCheck=function(){window.cordova&&window.NativeStorage&&(this.nativeStorageI=window.NativeStorage)},e.prototype.getItemNs=function(e){var n=this;return new Promise(function(t,r){window.cordova&&window.NativeStorage&&n.nativeStorageI.getItem(e,function(e){t(e)},function(e){r(e)})})},e.prototype.setItemNs=function(e,n){var o=this;return new Promise(function(t,r){window.cordova&&window.NativeStorage&&o.nativeStorageI.setItem(e,n,function(e){t(e)},function(e){r(e)})})},e.prototype.removeItemNs=function(e){var n=this;return new Promise(function(t,r){window.cordova&&window.NativeStorage&&n.nativeStorageI.remove(e,function(e){t(e)},function(e){r(e)})})},e.prototype.clearNs=function(){var e=this;return new Promise(function(t,r){window.cordova&&window.NativeStorage&&e.nativeStorageI.clear(function(e){t(e)},function(e){r(e)})})},e.prototype.initNgForage=function(){this.ngfConfig.configure({name:"MyApp",driver:[t.NgForageConfig.DRIVER_WEBSQL]})},e.prototype.promiseReflect=function(e){return e.then(function(e){return{v:e,status:"resolved"}},function(e){return{e:e,status:"rejected"}})},e.prototype.clearLocalStorage=function(){this.remove("userObj"),this.remove("accessToken"),this.remove("refreshToken"),this.remove("registrationId")},e.prototype.checkDeviceId=function(){var t=this;return"browser"===d.getInstance().checkDevice()?(this._deviceUUID=this.getValue("uuid"),this._deviceUUID||(this._deviceUUID=(new g).generateUUID(),this.setValue("uuid",this._deviceUUID))):window.plugins.uniqueDeviceID.get(function(e){t._deviceUUID=e,t.setValue("uuid",t._deviceUUID)}),this._deviceUUID},Object.defineProperty(e.prototype,"deviceUUID",{get:function(){return this._deviceUUID},enumerable:!0,configurable:!0}),e.decorators=[{type:i.Injectable}],e.ctorParameters=function(){return[{type:t.NgForageConfig},{type:t.NgForage},{type:t.NgForageCache}]},e}(),b=function(){function e(e){this.nLocalStorageService=e,this.nSessionStorage=new f}return e.prototype.updateTokens=function(e,t){var r=this.decodeToken(e.accessToken);this.nSessionStorage.setValue("accessToken",e.accessToken),this.nSessionStorage.setValue("refreshToken",e.refreshToken),this.nSessionStorage.setValue("userObj",JSON.stringify(r)),(t||this.nLocalStorageService.getValue("accessToken"))&&(this.nLocalStorageService.setValue("accessToken",e.accessToken),this.nLocalStorageService.setValue("refreshToken",e.refreshToken),this.nLocalStorageService.setValue("userObj",JSON.stringify(r)))},e.prototype.updateSessionStorage=function(){this.updateTokens(this.nLocalStorageService.getStorage(),!0)},e.prototype.urlBase64Decode=function(e){var t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw"Illegal base64url string!"}return this.b64DecodeUnicode(t)},e.prototype.b64decode=function(e){var t="";if((e=String(e).replace(/=+$/,"")).length%4==1)throw new Error("'atob' failed: The string to be decoded is not correctly encoded.");for(var r=0,n=void 0,o=void 0,i=0;o=e.charAt(i++);~o&&(n=r%4?64*n+o:o,r++%4)?t+=String.fromCharCode(255&n>>(-2*r&6)):0)o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(o);return t},e.prototype.b64DecodeUnicode=function(e){return decodeURIComponent(Array.prototype.map.call(this.b64decode(e),function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)}).join(""))},e.prototype.decodeToken=function(e){var t=e.split(".");if(3!==t.length)throw new Error("JWT must have 3 parts");var r=this.urlBase64Decode(t[1]);if(!r)throw new Error("Cannot decode the token");return JSON.parse(r)},e.prototype.getTokenExpirationDate=function(e){var t;if(!(t=this.decodeToken(e)).hasOwnProperty("exp"))return null;var r=new Date(0);return r.setUTCSeconds(t.exp),r},e.prototype.isTokenExpired=function(e,t){var r=this.getTokenExpirationDate(e);return t=t||0,null!=r&&!(r.valueOf()>(new Date).valueOf()+1e3*t)},e.decorators=[{type:i.Injectable}],e.ctorParameters=function(){return[{type:v}]},e}(),S="PubSub Service",y=function(){function e(){this.events={}}return e.prototype.$sub=function(e,t,r,n){if(!e)throw new Error("["+S+"] => Subscription method must get event name.");return this.events[e]===undefined&&(this.events[e]=new o.Subject),"function"!=typeof t?this.events[e].asObservable():this.events[e].asObservable().subscribe(t,r,n)},e.prototype.$pub=function(e,t){if(!e)throw new Error("["+S+"] => Publish method must get event name.");this.events[e]&&this.events[e].next(t)},e.decorators=[{type:i.Injectable}],e.ctorParameters=function(){return[]},e}(),m=function(){function e(e){this.nLocalStorageService=e,this.nSessionStorage=new f}return e.prototype.logout=function(){return this.nSessionStorage.clearSessionStorage(),this.nLocalStorageService.clearLocalStorage(),!0},e.decorators=[{type:i.Injectable}],e.ctorParameters=function(){return[{type:v}]},e}(),w=function(){function e(e,t){this.nLogoutService=e,this.nPubSubService=t,this.pendingRequests=0,this.showLoading=!1,this._isHTTPRequestInProgress=new o.Subject,this._isHTTPRequestInProgress$=this._isHTTPRequestInProgress.asObservable()}return e.prototype.isHTTPRequestInProgress=function(e){e?(this.pendingRequests++,this.showLoading||this._isHTTPRequestInProgress.next(e),this.showLoading=!0):(this.pendingRequests--,this.pendingRequests<=0&&(this.showLoading&&this._isHTTPRequestInProgress.next(e),this.showLoading=!1))},e.prototype.alertError=function(e){e.status<200||500<e.status?0===e.status?this.nPubSubService.$pub("openSnackBar","Connectivity issue"):this.nPubSubService.$pub("openSnackBar","Response failure"):401===e.status?(this.nLogoutService.logout(),e.error?this.nPubSubService.$pub("openSnackBar",e.error):this.nPubSubService.$pub("openSnackBar",e)):e.error?e.error instanceof Object?this.nPubSubService.$pub("openSnackBar",e.error.message):this.nPubSubService.$pub("openSnackBar",e.error):this.nPubSubService.$pub("openSnackBar","Response failure")},e.decorators=[{type:i.Injectable}],e.ctorParameters=function(){return[{type:m},{type:y}]},e}(),k=function(){function e(e,t,r,n){var o=this;this.localStorageService=e,this.pubSubService=t,this.http=r,this.bHttpLoader=n,this.systemService=d.getInstance(),this.possiblePushTypes=["APNS","FCM"],this.firebaseSenderId=this.systemService.getVal("firebaseSenderId"),this.isNotificationEnabled=this.systemService.getVal("isNotificationEnabled"),this.appName=this.systemService.getVal("appName"),this.deviceType=this.systemService.deviceType,this.sessionStorage=new f,this.loginSubscribe=this.pubSubService.$sub("firebaseRegister",function(){o.enableNotification()})}return e.prototype.ngOnInit=function(){},e.prototype.enableNotification=function(){var t=this,r=this.getPushType(this.systemService.getVal("pushType"));document.addEventListener("deviceready",function(e){t.isNotificationEnabled&&t.deviceType&&"browser"!=t.deviceType&&(t.deviceType=t.systemService.deviceType,t.checkPermission(r).then(function(e){e&&t.initializeNotifications(r)}))}),this.isNotificationEnabled&&"APNS"!==r&&this.deviceType&&"browser"==this.deviceType&&window.Notification&&this.initialiseWebPush()},e.prototype.initialiseWebPush=function(){var t=this,e=n.messaging();e.requestPermission().then(function(){return e.getToken()}).then(function(e){e&&t.sendRegDetails(e)})["catch"](function(e){t.bHttpLoader.alertError(e)}),e.onMessage(function(e){if(e.notification){var t=e.notification,r={body:t.body,icon:t.icon};new Notification(t.title,r).onclick=function(){window.focus()}}})},e.prototype.checkPermission=function(e){var r=this;return new Promise(function(t){if(e=r.getPushType(e),"Android"!==r.deviceType&&"iOS"!==r.deviceType||"FCM"!==e){if("iOS"!==r.deviceType||"APNS"!==e)return t(!0);APNSPushNotification.hasPermission(function(e){return t(e.isEnabled)})}else PushNotification.hasPermission(function(e){return t(e.isEnabled)})})},e.prototype.initializeNotifications=function(e){var t,r=this;"FCM"===(e=this.getPushType(e))?t=window.PushNotification.init({android:{senderID:this.firebaseSenderId},ios:{alert:"true",badge:"true",sound:"true",senderID:this.firebaseSenderId}}):"APNS"===e&&(t=window.APNSPushNotification.init({ios:{alert:"true",badge:"true",sound:"true"}})),t.on("registration",function(e){r.sendRegDetails(e.registrationId)}),t.on("notification",function(e){window.cordova.plugins.notification.local.schedule({title:e.title,text:e.message,sound:e.sound,at:(new Date).getTime()})}),t.on("error",function(e){console.error(e)})},e.prototype.sendRegDetails=function(e){this.localStorageService.setValue("registrationId",e);var t=this.systemService.getTenantUrl()+"notification/"+this.systemService.getVal("appName")+"/register",r=this.getPushType(this.systemService.getVal("pushType"));this.http.post(t,{key:this.sessionStorage.getValue("userObj").userKey,uuid:this.localStorageService.getValue("uuid"),fbregid:e,pushType:r}).subscribe(function(e){},function(e){console.log(e)})},e.prototype.getPushType=function(e){return void 0!==e&&this.possiblePushTypes.includes(e.toUpperCase())?e.toUpperCase():"FCM"},e.prototype.ngOnDestroy=function(){this.loginSubscribe.unSubscribe()},e.decorators=[{type:i.Injectable}],e.ctorParameters=function(){return[{type:v},{type:y},{type:s.HttpClient},{type:w}]},e}(),I=function(){function e(e,t,r,n,o){this.http=e,this.pubSubService=t,this.notificationService=r,this.nLocalStorageService=n,this.nTokenService=o,this.loginCompleted=new i.EventEmitter,this.systemService=d.getInstance(),this.nSessionStorage=new f}return e.prototype.login=function(e,t,r){var n=this;return this.appProperties=this.systemService.getVal("properties"),this.loginUrl=this.systemService.getAuthUrl()+this.appProperties.appName,this.uuid=this.nLocalStorageService.getValue("uuid"),this.uuid||(this.uuid=this.nLocalStorageService.checkDeviceId()),this.details={username:e,password:t},this.details.platformDetails=this.systemService.getPlatformDetails(this.systemService.checkDevice()),this.details.platformDetails.uuid=this.uuid,this.http.post(this.loginUrl,JSON.stringify(this.details)).map(function(e){var t=e;return t&&n.nTokenService.updateTokens(t,r),("FIREBASE_SENDER_ID"!=n.systemService.getVal("firebaseSenderId")&&"FIREBASE_AUTH_KEY"!=n.systemService.getVal("firebaseAuthKey")||"APNS"===n.systemService.getVal("pushType")&&n.systemService.isIOS())&&n.pubSubService.$pub("firebaseRegister"),n.pubSubService.$pub("loginComplete"),e},function(e){return e})},e.prototype.isLoggedIn=function(){var t=this;return this.nLocalStorageService.initStorage().then(function(e){return!(!t.nSessionStorage.getValue("accessToken")||!t.nSessionStorage.getValue("refreshToken")||"null"==t.nSessionStorage.getValue("accessToken")||"null"==t.nSessionStorage.getValue("refreshToken"))})["catch"](function(e){return!1})},e.decorators=[{type:i.Injectable}],e.ctorParameters=function(){return[{type:s.HttpClient},{type:y},{type:k},{type:v},{type:b}]},e.propDecorators={loginCompleted:[{type:i.Output}]},e}(),P=function(){function e(e,t){this.nLoginService=e,this.router=t}return e.prototype.canActivate=function(){var t=this;return this.nLoginService.isLoggedIn().then(function(e){return!!e||(t.router.navigate(["unauthorized"]),!1)})},e.decorators=[{type:i.Injectable}],e.ctorParameters=function(){return[{type:I},{type:c.Router}]},e}(),T=function(){function e(e){this.http=e,this.invalidDataModelName="Invalid data model name.",this.invalidDataModelId="Invalid data model id.",this.invalidDataModelObj="Invalid data model object.",this.systemService=d.getInstance()}return e.prototype.get=function(e,t,r,n,o,i){if(e){var s=this.getDataSourceURL(e)+e;if(this.checkIfValid(t)||this.checkIfValid(r)||this.checkIfValid(n)||this.checkIfValid(o)||this.checkIfValid(i)){var a=""+this.toQueryString({filter:t,keys:r,sort:n,pagenumber:o,pagesize:i});""===a?a+="?filter={}":a="?".concat(a),s+=a}return this.http.get(s).map(function(e,t){return e})["catch"](function(e){return u.Observable["throw"](e)})}return u.Observable["throw"](new Error("Could not get "+e+". "+this.invalidDataModelName))},e.prototype.put=function(e,t){if(e){if(t){var r=this.getDataSourceURL(e)+e;return this.http.put(r,t).map(function(e,t){return e})["catch"](function(e){return u.Observable["throw"](e)})}return u.Observable["throw"](new Error("Could not put "+t+" in "+e+". "+this.invalidDataModelObj))}return u.Observable["throw"](new Error("Could not put "+t+" in "+e+". "+this.invalidDataModelName))},e.prototype["delete"]=function(e,t){var r;return e?(r=this.getDataSourceURL(e)+e,this.checkIfValid(t)&&""!=t?r+="?filter="+t:r+="?filter={}",this.http["delete"](r).map(function(e,t){return e})["catch"](function(e){return u.Observable["throw"](e)})):u.Observable["throw"](new Error("Could not delete "+e+". "+this.invalidDataModelName))},e.prototype.update=function(e,t){if(e&&t){var r=this.getDataSourceURL(e)+e;return this.http.patch(r,t).map(function(e,t){return e})["catch"](function(e){return u.Observable["throw"](e)})}return u.Observable["throw"](new Error("Could not update "+e+". "+this.invalidDataModelName))},e.prototype.getById=function(e,t){if(e){if(t){var r=this.getDataSourceURL(e)+e+"/"+t;return this.http.get(r).map(function(e,t){return e})["catch"](function(e){return u.Observable["throw"](e)})}u.Observable["throw"](new Error("Could not get "+e+" by id "+t+". "+this.invalidDataModelId))}else u.Observable["throw"](new Error("Could not get "+e+" by id "+t+". "+this.invalidDataModelName))},e.prototype.deleteById=function(e,t){if(!e)return u.Observable["throw"](new Error("Could not delete "+e+" by id "+t+". "+this.invalidDataModelName));if(t){var r=this.getDataSourceURL(e)+e+"/"+t;return this.http["delete"](r).map(function(e,t){return e})["catch"](function(e){return u.Observable["throw"](e)})}u.Observable["throw"](new Error("Could not get "+e+" by id "+t+". "+this.invalidDataModelId))},e.prototype.updateById=function(e,t,r){if(!e)return u.Observable["throw"](new Error("Could not delete "+e+" by id "+t+". "+this.invalidDataModelName));if(t){var n=this.getDataSourceURL(e)+e+"/"+t,o=Object.assign({},r);return delete o._id,this.http.patch(n,o).map(function(e,t){return e})["catch"](function(e){return u.Observable["throw"](e)})}u.Observable["throw"](new Error("Could not get "+e+" by id "+t+". "+this.invalidDataModelId))},e.prototype.toQueryString=function(e){var t=[];for(var r in e)e.hasOwnProperty(r)&&this.checkIfValid(e[r])&&t.push(r+"="+JSON.stringify(e[r]));return t.join("&")},e.prototype.checkIfValid=function(e){return e!==undefined&&null!=e},e.prototype.getDataSourceURL=function(e){this.dmDs||(this.dmDs=window.neutrinos.dataSource);var t=this.dmDs[e],r=this.systemService.properties;return t?r.baseUrl+r.tenantName+"/datamodel/"+t+"/"+r.appName+"/":this.systemService.getDataModelUrl()},e.decorators=[{type:i.Injectable}],e.ctorParameters=function(){return[{type:s.HttpClient}]},e}(),x=function(){function e(e,t,r,n){this.nHTTPLoader=e,this.inj=t,this.nLocalStorageService=r,this.nTokenService=n,this.timeout=9e4,this.isRefreshingToken=!1,this.tokenSubject=new p.BehaviorSubject(null),this.systemService=d.getInstance(),this.nSessionStorage=new f,this.appProperties=this.systemService.getVal("properties"),this.nPubSubService=new y}return e.prototype.intercept=function(t,r){var n=this;return this.requestInterceptor(),r.handle(this.requestOptions(t)).timeout(this.timeout)["catch"](function(e){return n.onCatch(e,t,r)})["finally"](function(){n.onFinally()})},e.prototype.updateToken=function(e,r,n){var o=this;return"activeDirectory"===this.appProperties.appAuthenticationStrategy||"localAuth"===this.appProperties.appAuthenticationStrategy?this.isRefreshingToken?this.tokenSubject.filter(function(e){return null!=e}).take(1).switchMap(function(e){return n.handle(o.requestOptions(r))}):(this.isRefreshingToken=!0,this.tokenSubject.next(null),this.refreshToken().switchMap(function(e){if(e){o.nTokenService.updateTokens(e);var t=e.accessToken;return o.tokenSubject.next(t),n.handle(o.requestOptions(r))}return p.Observable["throw"](new Error("Can't refresh the token"))})["catch"](function(e){return o.onCatchError(e)})["finally"](function(){return o.isRefreshingToken=!1})):this.onCatchError(e)},e.prototype.refreshToken=function(){var e=this.inj.get(s.HttpClient),t=this.systemService.getVal("properties"),r=this.systemService.getAuthUrl()+t.appName+"/refresh",n={platformDetails:this.systemService.getPlatformDetails(this.systemService.checkDevice()),userKey:this.nSessionStorage.getValue("userObj").userKey,refreshToken:this.nSessionStorage.getValue("refreshToken")};return n.platformDetails.uuid=this.nLocalStorageService.getValue("uuid"),e.post(r,n)},e.prototype.requestOptions=function(e){var t=e.headers;null==e.headers&&(t=new s.HttpHeaders),e=e.clone({url:this.getFullUrl(e.url),headers:t});var r=d.getInstance().getVal("baseUrl");return""!==r&&e.url.includes(r)?this.addDefaultHeaders(e):e},e.prototype.addDefaultHeaders=function(e){if(e.headers.has("Access-Control-Allow-Origin")||(e.headers=e.headers.set("Access-Control-Allow-Origin","*")),e.headers.has("Content-Type")?e.headers.has("Content-Type")&&"no-content"===e.headers.get("Content-Type")&&(e.headers=e.headers["delete"]("Content-Type")):e.headers=e.headers.set("Content-Type","application/json"),e.headers.has("Accept")||(e.headers=e.headers.set("Accept","application/json")),!e.headers.has("Authorization"))if(this.appProperties=this.systemService.getVal("properties"),this.appProperties&&"basicAuth"===this.appProperties.appAuthenticationStrategy){var t=void 0,r=void 0;this.appProperties.basicAuthUser&&this.appProperties.basicAuthPassword?(t=this.appProperties.basicAuthUser,r=this.appProperties.basicAuthPassword):(t="bhive-art-proxyuser",r="password",console.warn("Authentication strategy: Basic Auth. basicAuthUser and basicAuthPassword are not configured in environment. Setting default values.")),e.headers=e.headers.set("Authorization","Basic "+btoa(t+":"+r))}else!this.appProperties||"activeDirectory"!==this.appProperties.appAuthenticationStrategy&&"localAuth"!==this.appProperties.appAuthenticationStrategy||this.nSessionStorage.getValue("accessToken")&&(e.headers=e.headers.set("Authorization","Bearer "+this.nSessionStorage.getValue("accessToken")));return e},e.prototype.getFullUrl=function(e){return e},e.prototype.requestInterceptor=function(){this.nHTTPLoader.isHTTPRequestInProgress(!0)},e.prototype.responseInterceptor=function(){this.nHTTPLoader.isHTTPRequestInProgress(!1)},e.prototype.onCatch=function(e,t,r){return e instanceof s.HttpErrorResponse&&403===e.status&&"jwt expired"===e.error.message?this.updateToken(e,t,r):this.onSubscribeError(e)},e.prototype.onSubscribeError=function(e){return this.nHTTPLoader.alertError(e),this.onCatchError(e)},e.prototype.onFinally=function(){this.responseInterceptor()},e.prototype.onCatchError=function(e){return p.Observable["throw"](e)},e.decorators=[{type:i.Injectable}],e.ctorParameters=function(){return[{type:w},{type:i.Injector},{type:v},{type:b}]},e}(),C=function(){function e(e){var t=this;this.nPubSubService=e,this.snackService=new o.Subject,d.getInstance().getVal("useDefaultExceptionUI")&&(this.snackBarListner=this.nPubSubService.$sub("openSnackBar",function(e){t.openSnackBar(e)}))}return e.prototype.get=function(){return this.snackService.asObservable()},e.prototype.add=function(e){this.snackService.next({action:"add",data:e})},e.prototype.remove=function(e){this.snackService.next({action:"remove",id:e})},e.prototype.clear=function(){this.snackService.next({action:"clear"})},e.prototype.openSnackBar=function(e,t){this.add({msg:e,timeout:t||5e3,action:{text:"Close",onClick:function(e){}},onAdd:function(e){},onRemove:function(e){}})},e.decorators=[{type:i.Injectable}],e.ctorParameters=function(){return[{type:y}]},e}(),N=function(){function e(){}return e.decorators=[{type:i.Component,args:[{selector:"n-snack",template:"\n     <div class=\"snack\" [ngStyle]=\"{background: background ? background : '#323232' , color: color ? color : '#fff'}\" [ngClass]=\" ['snackbar-layout', 'customClass' ]\">\n          <ng-content></ng-content>\n       </div> \n  ",styles:[".snack-action{cursor:pointer;color:#2196f3;font-weight:700}.container{display:flex;flex-direction:row;flex-wrap:wrap}.child{width:60%;flex:1 0;margin-right:.5em}.snackbars.bottom-center{align-items:middle;left:50%;-webkit-transform:translate(-50%,0);transform:translate(-50%,0);bottom:1px;align-items:center}.snackbars{position:fixed;z-index:99999;max-width:100%;word-wrap:break-word;display:inline;font-family:Roboto;letter-spacing:1px}.snack{padding:1em;border-radius:.3em;max-height:50vh;overflow:auto}"]}]}],e.propDecorators={background:[{type:i.Input}],color:[{type:i.Input}],customClass:[{type:i.Input}]},e}(),D=function(){function e(e){var t=this;this.snackbarService=e,this.max=1,this.onAdd=new i.EventEmitter,this.onRemove=new i.EventEmitter,this.onClear=new i.EventEmitter,this.snacks=[],this.snackbarService.get().subscribe(function(e){"add"===e.action?t.add(e.data):"remove"===e.action?t.remove(e.id):"clear"===e.action&&t.clear()})}return e.prototype.add=function(e){var t,r=this,n=this.uuid();this.max&&0<this.max&&this.snacks.length===this.max&&this.remove(this.snacks[0].id),(e.timeout||this.timeout)&&(t=setTimeout(function(){r.remove(n)},e.timeout||this.timeout));var o=Object.assign({id:n,timeoutObj:t},e);if(e.action){var i=this,s=e.action.onClick||new Function;e.action.onClick=function(){s(o),i.remove(n)}}e.onAdd&&e.onAdd(o),this.onAdd&&this.onAdd.emit(o),this.snacks.push(o)},e.prototype.remove=function(t){var e=this.snacks.find(function(e){return e.id===t});e&&(e.onRemove&&e.onRemove(e),this.onRemove&&this.onRemove.emit(e),e.timeoutObj&&clearTimeout(e.timeoutObj)),this.snacks=this.snacks.filter(function(e){return e.id!==t})},e.prototype.clear=function(){this.snacks=[],this.onClear&&this.onClear.emit(!0)},e.prototype.uuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})},e.prototype.calcTextColor=function(e){if(!e)return null;var t=function o(e){e=e.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,function(e,t,r,n){return t+t+r+r+n+n});var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:null}(e);if(!t)return null;for(var r=[t.r/255,t.g/255,t.b/255],n=0;n<r.length;++n)r[n]<=.03928?r[n]=r[n]/12.92:r[n]=Math.pow((r[n]+.055)/1.055,2.4);return.179<.2126*r[0]+.7152*r[1]+.0722*r[2]?"#000":"#fff"},e.decorators=[{type:i.Component,args:[{selector:"n-snackbar",template:'\n      <div class="snackbars" [ngClass]="position || \'bottom-center\'">\n          <n-snack   *ngFor="let snackbar of snacks" [background]="snackbar.background || background"\n                        [customClass]="snackbar.customClass || customClass"\n                        [color]="snackbar.color || color || calcTextColor(snackbar.background || background)">\n              <div class="container">\n              <div class="snack-text child" >\n                  {{snackbar.msg}}\n              </div>\n              <div *ngIf="snackbar.action.text" class="snack-action" (click)="snackbar.action.onClick()"\n                   [ngStyle]="{color: snackbar.action.color || accent}">\n                  {{snackbar.action.text}}\n              </div>\n              </div>\n          </n-snack>\n      </div>\n  ',styles:[".snack-action{cursor:pointer;color:#2196f3;font-weight:700}.container{display:flex;flex-direction:row;flex-wrap:wrap}.child{width:60%;flex:1 0;margin-right:.5em}.snackbars.bottom-center{align-items:middle;left:50%;-webkit-transform:translate(-50%,0);transform:translate(-50%,0);bottom:1px;align-items:center}.snackbars{position:fixed;z-index:99999;max-width:100%;word-wrap:break-word;display:inline;font-family:Roboto;letter-spacing:1px}.snack{padding:1em;border-radius:.3em;max-height:50vh;overflow:auto}"]}]}],e.ctorParameters=function(){return[{type:C}]},e.propDecorators={position:[{type:i.Input}],max:[{type:i.Input}],background:[{type:i.Input}],accent:[{type:i.Input}],color:[{type:i.Input}],customClass:[{type:i.Input}],timeout:[{type:i.Input}],onAdd:[{type:i.Output}],onRemove:[{type:i.Output}],onClear:[{type:i.Output}]},e}();function O(e){return function(){return e.initStorage()}}var j=function(){function e(){}return e.decorators=[{type:i.NgModule,args:[{imports:[h.CommonModule,s.HttpClientModule,c.RouterModule,l.HttpModule,t.NgForageModule.forRoot()],providers:[{provide:s.HTTP_INTERCEPTORS,useClass:x,multi:!0},{provide:i.APP_INITIALIZER,useFactory:O,deps:[v],multi:!0},P,T,x,w,v,I,m,k,C,y,f,b],declarations:[N,D],exports:[N,D]}]}],e}();e.NAuthGuardService=P,e.NDataModelService=T,e.NHttpService=x,e.NHTTPLoaderService=w,e.NLocalStorageService=v,e.NLoginService=I,e.NLogoutService=m,e.NNotificationService=k,e.NSnackbarService=C,e.NSystemService=d,e.NTokenService=b,e.NUtility=g,e.NPubSubService=y,e.NSessionStorageService=f,e.SnackbarComponent=D,e.startupServiceFactory=O,e.NeutrinosSeedServicesModule=j,e.Éµa=N,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=neutrinos-seed-services.umd.min.js.map