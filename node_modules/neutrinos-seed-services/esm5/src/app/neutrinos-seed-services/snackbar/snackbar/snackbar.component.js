/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */
import { Component, EventEmitter, Input, Output } from '@angular/core';
import { NSnackbarService } from '../../n-snackbar.service';
var SnackbarComponent = /** @class */ (function () {
    function SnackbarComponent(snackbarService) {
        var _this = this;
        this.snackbarService = snackbarService;
        this.max = 1;
        this.onAdd = new EventEmitter();
        this.onRemove = new EventEmitter();
        this.onClear = new EventEmitter();
        this.snacks = [];
        this.snackbarService.get()
            .subscribe(function (snack) {
            if (snack.action === 'add') {
                _this.add(snack.data);
            }
            else if (snack.action === 'remove') {
                _this.remove(snack.id);
            }
            else if (snack.action === 'clear') {
                _this.clear();
            }
        });
    }
    /**
     * @param {?} snack
     * @return {?}
     */
    SnackbarComponent.prototype.add = /**
     * @param {?} snack
     * @return {?}
     */
    function (snack) {
        var _this = this;
        var /** @type {?} */ timeout;
        var /** @type {?} */ id = this.uuid();
        if (this.max && this.max > 0 && this.snacks.length === this.max) {
            this.remove(this.snacks[0].id);
        }
        if (snack.timeout || this.timeout) {
            timeout = setTimeout(function () {
                _this.remove(id);
            }, snack.timeout || this.timeout);
        }
        var /** @type {?} */ data = Object.assign({ id: id, timeoutObj: timeout }, snack);
        if (snack.action) {
            var /** @type {?} */ that_1 = this;
            var /** @type {?} */ fcn_1 = snack.action.onClick || new Function();
            snack.action.onClick = function () {
                fcn_1(data);
                that_1.remove(id);
            };
        }
        if (snack.onAdd) {
            snack.onAdd(data);
        }
        if (this.onAdd) {
            this.onAdd.emit(data);
        }
        this.snacks.push(data);
    };
    /**
     * @param {?} id
     * @return {?}
     */
    SnackbarComponent.prototype.remove = /**
     * @param {?} id
     * @return {?}
     */
    function (id) {
        var /** @type {?} */ snack = this.snacks.find(function (obj) { return obj.id === id; });
        if (snack) {
            if (snack.onRemove) {
                snack.onRemove(snack);
            }
            if (this.onRemove) {
                this.onRemove.emit(snack);
            }
            if (snack.timeoutObj) {
                clearTimeout(snack.timeoutObj);
            }
        }
        this.snacks = this.snacks.filter(function (obj) { return obj.id !== id; });
    };
    /**
     * @return {?}
     */
    SnackbarComponent.prototype.clear = /**
     * @return {?}
     */
    function () {
        // this.snacks.forEach(snack => {
        //   this.remove(snack.id);
        // });
        this.snacks = [];
        if (this.onClear) {
            this.onClear.emit(true);
        }
    };
    /**
     * @return {?}
     */
    SnackbarComponent.prototype.uuid = /**
     * @return {?}
     */
    function () {
        // tslint:disable:no-bitwise
        return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {
            var /** @type {?} */ r = Math.random() * 16 | 0, /** @type {?} */ v = c === 'x' ? r : (r & 0x3 | 0x8);
            return v.toString(16);
        });
        // tslint:enable:no-bitwise
    };
    /**
     * @param {?} background
     * @return {?}
     */
    SnackbarComponent.prototype.calcTextColor = /**
     * @param {?} background
     * @return {?}
     */
    function (background) {
        if (!background) {
            return null;
        }
        /**
         * @param {?} hex
         * @return {?}
         */
        function hexToRgb(hex) {
            var /** @type {?} */ shorthandRegex = /^#?([a-f\d])([a-f\d])([a-f\d])$/i;
            hex = hex.replace(shorthandRegex, function (m, r, g, b) {
                return r + r + g + g + b + b;
            });
            var /** @type {?} */ result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
            return result ? {
                r: parseInt(result[1], 16),
                g: parseInt(result[2], 16),
                b: parseInt(result[3], 16)
            } : null;
        }
        var /** @type {?} */ rgb = hexToRgb(background);
        if (!rgb) {
            return null;
        }
        var /** @type {?} */ color = [rgb.r / 255, rgb.g / 255, rgb.b / 255];
        for (var /** @type {?} */ i = 0; i < color.length; ++i) {
            if (color[i] <= 0.03928) {
                color[i] = color[i] / 12.92;
            }
            else {
                color[i] = Math.pow((color[i] + 0.055) / 1.055, 2.4);
            }
        }
        var /** @type {?} */ l = 0.2126 * color[0] + 0.7152 * color[1] + 0.0722 * color[2];
        if (l > 0.179) {
            return '#000';
        }
        else {
            return '#fff';
        }
    };
    SnackbarComponent.decorators = [
        { type: Component, args: [{
                    selector: 'n-snackbar',
                    template: "\n      <div class=\"snackbars\" [ngClass]=\"position || 'bottom-center'\">\n          <n-snack   *ngFor=\"let snackbar of snacks\" [background]=\"snackbar.background || background\"\n                        [customClass]=\"snackbar.customClass || customClass\"\n                        [color]=\"snackbar.color || color || calcTextColor(snackbar.background || background)\">\n              <div class=\"container\">\n              <div class=\"snack-text child\" >\n                  {{snackbar.msg}}\n              </div>\n              <div *ngIf=\"snackbar.action.text\" class=\"snack-action\" (click)=\"snackbar.action.onClick()\"\n                   [ngStyle]=\"{color: snackbar.action.color || accent}\">\n                  {{snackbar.action.text}}\n              </div>\n              </div>\n          </n-snack>\n      </div>\n  ",
                    styles: [".snack-action{cursor:pointer;color:#2196f3;font-weight:700}.container{display:flex;flex-direction:row;flex-wrap:wrap}.child{width:60%;flex:1 0;margin-right:.5em}.snackbars.bottom-center{align-items:middle;left:50%;-webkit-transform:translate(-50%,0);transform:translate(-50%,0);bottom:1px;align-items:center}.snackbars{position:fixed;z-index:99999;max-width:100%;word-wrap:break-word;display:inline;font-family:Roboto;letter-spacing:1px}.snack{padding:1em;border-radius:.3em;max-height:50vh;overflow:auto}"]
                },] },
    ];
    /** @nocollapse */
    SnackbarComponent.ctorParameters = function () { return [
        { type: NSnackbarService, },
    ]; };
    SnackbarComponent.propDecorators = {
        "position": [{ type: Input },],
        "max": [{ type: Input },],
        "background": [{ type: Input },],
        "accent": [{ type: Input },],
        "color": [{ type: Input },],
        "customClass": [{ type: Input },],
        "timeout": [{ type: Input },],
        "onAdd": [{ type: Output },],
        "onRemove": [{ type: Output },],
        "onClear": [{ type: Output },],
    };
    return SnackbarComponent;
}());
export { SnackbarComponent };
function SnackbarComponent_tsickle_Closure_declarations() {
    /** @type {!Array<{type: !Function, args: (undefined|!Array<?>)}>} */
    SnackbarComponent.decorators;
    /**
     * @nocollapse
     * @type {function(): !Array<(null|{type: ?, decorators: (undefined|!Array<{type: !Function, args: (undefined|!Array<?>)}>)})>}
     */
    SnackbarComponent.ctorParameters;
    /** @type {!Object<string,!Array<{type: !Function, args: (undefined|!Array<?>)}>>} */
    SnackbarComponent.propDecorators;
    /** @type {?} */
    SnackbarComponent.prototype.position;
    /** @type {?} */
    SnackbarComponent.prototype.max;
    /** @type {?} */
    SnackbarComponent.prototype.background;
    /** @type {?} */
    SnackbarComponent.prototype.accent;
    /** @type {?} */
    SnackbarComponent.prototype.color;
    /** @type {?} */
    SnackbarComponent.prototype.customClass;
    /** @type {?} */
    SnackbarComponent.prototype.timeout;
    /** @type {?} */
    SnackbarComponent.prototype.onAdd;
    /** @type {?} */
    SnackbarComponent.prototype.onRemove;
    /** @type {?} */
    SnackbarComponent.prototype.onClear;
    /** @type {?} */
    SnackbarComponent.prototype.snacks;
    /** @type {?} */
    SnackbarComponent.prototype.snackbarService;
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic25hY2tiYXIuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vbmV1dHJpbm9zLXNlZWQtc2VydmljZXMvIiwic291cmNlcyI6WyJzcmMvYXBwL25ldXRyaW5vcy1zZWVkLXNlcnZpY2VzL3NuYWNrYmFyL3NuYWNrYmFyL3NuYWNrYmFyLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUFFLFNBQVMsRUFBRSxZQUFZLEVBQUUsS0FBSyxFQUFFLE1BQU0sRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUN2RSxPQUFPLEVBQUUsZ0JBQWdCLEVBQUUsTUFBTSwwQkFBMEIsQ0FBQzs7SUEwQzFELDJCQUFvQixlQUFpQztRQUFyRCxpQkFXQztRQVhtQixvQkFBZSxHQUFmLGVBQWUsQ0FBa0I7bUJBakI5QixDQUFDO3FCQU9vQixJQUFJLFlBQVksRUFBTzt3QkFDcEIsSUFBSSxZQUFZLEVBQU87dUJBQ3BCLElBQUksWUFBWSxFQUFXO3NCQU14RSxFQUFFO1FBR0wsSUFBSSxDQUFDLGVBQWUsQ0FBQyxHQUFHLEVBQUU7YUFDdkIsU0FBUyxDQUFDLFVBQUEsS0FBSztZQUNkLEVBQUUsQ0FBQyxDQUFDLEtBQUssQ0FBQyxNQUFNLEtBQUssS0FBSyxDQUFDLENBQUMsQ0FBQztnQkFDM0IsS0FBSSxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUM7YUFDdEI7WUFBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUMsS0FBSyxDQUFDLE1BQU0sS0FBSyxRQUFRLENBQUMsQ0FBQyxDQUFDO2dCQUNyQyxLQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxFQUFFLENBQUMsQ0FBQzthQUN2QjtZQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQyxLQUFLLENBQUMsTUFBTSxLQUFLLE9BQU8sQ0FBQyxDQUFDLENBQUM7Z0JBQ3BDLEtBQUksQ0FBQyxLQUFLLEVBQUUsQ0FBQzthQUNkO1NBQ0YsQ0FBQyxDQUFDO0tB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RyxNQUFNLEdBQUcsS0FBSyxDQUFDLENBQUMsQ0FBQyxHQUFHLE1BQU0sR0FBRyxLQUFLLENBQUMsQ0FBQyxDQUFDLEdBQUcsTUFBTSxHQUFHLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUVwRSxFQUFFLENBQUMsQ0FBQyxDQUFDLEdBQUcsS0FBSyxDQUFDLENBQUMsQ0FBQztZQUNkLE1BQU0sQ0FBQyxNQUFNLENBQUM7U0FDZjtRQUFDLElBQUksQ0FBQyxDQUFDO1lBQ04sTUFBTSxDQUFDLE1BQU0sQ0FBQztTQUNmO0tBQ0Y7O2dCQTNLRixTQUFTLFNBQUM7b0JBQ1QsUUFBUSxFQUFFLFlBQVk7b0JBQ3RCLFFBQVEsRUFBRSx5MEJBZ0JUO29CQUNELE1BQU0sRUFBRSxDQUFDLDJmQUEyZixDQUFDO2lCQUN0Z0I7Ozs7Z0JBdEJRLGdCQUFnQjs7OzZCQXdCdEIsS0FBSzt3QkFDTCxLQUFLOytCQUNMLEtBQUs7MkJBQ0wsS0FBSzswQkFDTCxLQUFLO2dDQUNMLEtBQUs7NEJBQ0wsS0FBSzswQkFFTCxNQUFNOzZCQUNOLE1BQU07NEJBQ04sTUFBTTs7NEJBbkNUOztTQXdCYSxpQkFBaUIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIEV2ZW50RW1pdHRlciwgSW5wdXQsIE91dHB1dCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgTlNuYWNrYmFyU2VydmljZSB9IGZyb20gJy4uLy4uL24tc25hY2tiYXIuc2VydmljZSc7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ24tc25hY2tiYXInLFxuICB0ZW1wbGF0ZTogYFxuICAgICAgPGRpdiBjbGFzcz1cInNuYWNrYmFyc1wiIFtuZ0NsYXNzXT1cInBvc2l0aW9uIHx8ICdib3R0b20tY2VudGVyJ1wiPlxuICAgICAgICAgIDxuLXNuYWNrICAgKm5nRm9yPVwibGV0IHNuYWNrYmFyIG9mIHNuYWNrc1wiIFtiYWNrZ3JvdW5kXT1cInNuYWNrYmFyLmJhY2tncm91bmQgfHwgYmFja2dyb3VuZFwiXG4gICAgICAgICAgICAgICAgICAgICAgICBbY3VzdG9tQ2xhc3NdPVwic25hY2tiYXIuY3VzdG9tQ2xhc3MgfHwgY3VzdG9tQ2xhc3NcIlxuICAgICAgICAgICAgICAgICAgICAgICAgW2NvbG9yXT1cInNuYWNrYmFyLmNvbG9yIHx8IGNvbG9yIHx8IGNhbGNUZXh0Q29sb3Ioc25hY2tiYXIuYmFja2dyb3VuZCB8fCBiYWNrZ3JvdW5kKVwiPlxuICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwiY29udGFpbmVyXCI+XG4gICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJzbmFjay10ZXh0IGNoaWxkXCIgPlxuICAgICAgICAgICAgICAgICAge3tzbmFja2Jhci5tc2d9fVxuICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgPGRpdiAqbmdJZj1cInNuYWNrYmFyLmFjdGlvbi50ZXh0XCIgY2xhc3M9XCJzbmFjay1hY3Rpb25cIiAoY2xpY2spPVwic25hY2tiYXIuYWN0aW9uLm9uQ2xpY2soKVwiXG4gICAgICAgICAgICAgICAgICAgW25nU3R5bGVdPVwie2NvbG9yOiBzbmFja2Jhci5hY3Rpb24uY29sb3IgfHwgYWNjZW50fVwiPlxuICAgICAgICAgICAgICAgICAge3tzbmFja2Jhci5hY3Rpb24udGV4dH19XG4gICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICA8L24tc25hY2s+XG4gICAgICA8L2Rpdj5cbiAgYCxcbiAgc3R5bGVzOiBbYC5zbmFjay1hY3Rpb257Y3Vyc29yOnBvaW50ZXI7Y29sb3I6IzIxOTZmMztmb250LXdlaWdodDo3MDB9LmNvbnRhaW5lcntkaXNwbGF5OmZsZXg7ZmxleC1kaXJlY3Rpb246cm93O2ZsZXgtd3JhcDp3cmFwfS5jaGlsZHt3aWR0aDo2MCU7ZmxleDoxIDA7bWFyZ2luLXJpZ2h0Oi41ZW19LnNuYWNrYmFycy5ib3R0b20tY2VudGVye2FsaWduLWl0ZW1zOm1pZGRsZTtsZWZ0OjUwJTstd2Via2l0LXRyYW5zZm9ybTp0cmFuc2xhdGUoLTUwJSwwKTt0cmFuc2Zvcm06dHJhbnNsYXRlKC01MCUsMCk7Ym90dG9tOjFweDthbGlnbi1pdGVtczpjZW50ZXJ9LnNuYWNrYmFyc3twb3NpdGlvbjpmaXhlZDt6LWluZGV4Ojk5OTk5O21heC13aWR0aDoxMDAlO3dvcmQtd3JhcDpicmVhay13b3JkO2Rpc3BsYXk6aW5saW5lO2ZvbnQtZmFtaWx5OlJvYm90bztsZXR0ZXItc3BhY2luZzoxcHh9LnNuYWNre3BhZGRpbmc6MWVtO2JvcmRlci1yYWRpdXM6LjNlbTttYXgtaGVpZ2h0OjUwdmg7b3ZlcmZsb3c6YXV0b31gXVxufSlcbmV4cG9ydCBjbGFzcyBTbmFja2JhckNvbXBvbmVudCB7XG4gIEBJbnB1dCgpIHBvc2l0aW9uOiAndG9wLWxlZnQnIHwgJ3RvcC1jZW50ZXInIHwgJ3RvcC1yaWdodCcgfCAnYm90dG9tLWxlZnQnIHwgJ2JvdHRvbS1jZW50ZXInIHwgJ2JvdHRvbS1yaWdodCc7XG4gIEBJbnB1dCgpIG1heDogbnVtYmVyID0gMTtcbiAgQElucHV0KCkgYmFja2dyb3VuZDogc3RyaW5nO1xuICBASW5wdXQoKSBhY2NlbnQ6IHN0cmluZztcbiAgQElucHV0KCkgY29sb3I6IHN0cmluZztcbiAgQElucHV0KCkgY3VzdG9tQ2xhc3M6IGFueTtcbiAgQElucHV0KCkgdGltZW91dDogbnVtYmVyO1xuXG4gIEBPdXRwdXQoKSBwdWJsaWMgb25BZGQ6IEV2ZW50RW1pdHRlcjxhbnk+ID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XG4gIEBPdXRwdXQoKSBwdWJsaWMgb25SZW1vdmU6IEV2ZW50RW1pdHRlcjxhbnk+ID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XG4gIEBPdXRwdXQoKSBwdWJsaWMgb25DbGVhcjogRXZlbnRFbWl0dGVyPGJvb2xlYW4+ID0gbmV3IEV2ZW50RW1pdHRlcjxib29sZWFuPigpO1xuXG4gIHNuYWNrczogQXJyYXk8e1xuICAgIGlkOiBzdHJpbmcsIG1zZzogc3RyaW5nLCB0aW1lb3V0PzogbnVtYmVyLCBjb2xvcj86IHN0cmluZywgYmFja2dyb3VuZD86IHN0cmluZywgY3VzdG9tQ2xhc3M/OiBhbnksIGFjdGlvbj86IHtcbiAgICAgIHRleHQ6IHN0cmluZywgb25DbGljaz86IEZ1bmN0aW9uLCBjb2xvcj86IHN0cmluZ1xuICAgIH0sIG9uQWRkPzogRnVuY3Rpb24sIG9uUmVtb3ZlPzogRnVuY3Rpb24sIHRpbWVvdXRPYmo/OiBhbnlcbiAgfT4gPSBbXTtcblxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIHNuYWNrYmFyU2VydmljZTogTlNuYWNrYmFyU2VydmljZSkge1xuICAgIHRoaXMuc25hY2tiYXJTZXJ2aWNlLmdldCgpXG4gICAgICAuc3Vic2NyaWJlKHNuYWNrID0+IHtcbiAgICAgICAgaWYgKHNuYWNrLmFjdGlvbiA9PT0gJ2FkZCcpIHtcbiAgICAgICAgICB0aGlzLmFkZChzbmFjay5kYXRhKTtcbiAgICAgICAgfSBlbHNlIGlmIChzbmFjay5hY3Rpb24gPT09ICdyZW1vdmUnKSB7XG4gICAgICAgICAgdGhpcy5yZW1vdmUoc25hY2suaWQpO1xuICAgICAgICB9IGVsc2UgaWYgKHNuYWNrLmFjdGlvbiA9PT0gJ2NsZWFyJykge1xuICAgICAgICAgIHRoaXMuY2xlYXIoKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gIH1cblxuICBhZGQoc25hY2spIHtcbiAgICBsZXQgdGltZW91dDtcbiAgICBjb25zdCBpZCA9IHRoaXMudXVpZCgpO1xuXG4gICAgaWYgKHRoaXMubWF4ICYmIHRoaXMubWF4ID4gMCAmJiB0aGlzLnNuYWNrcy5sZW5ndGggPT09IHRoaXMubWF4KSB7XG4gICAgICB0aGlzLnJlbW92ZSh0aGlzLnNuYWNrc1swXS5pZCk7XG4gICAgfVxuXG4gICAgaWYgKHNuYWNrLnRpbWVvdXQgfHwgdGhpcy50aW1lb3V0KSB7XG4gICAgICB0aW1lb3V0ID0gc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgIHRoaXMucmVtb3ZlKGlkKTtcbiAgICAgIH0sIHNuYWNrLnRpbWVvdXQgfHwgdGhpcy50aW1lb3V0KVxuICAgIH1cblxuICAgIGNvbnN0IGRhdGEgPSBPYmplY3QuYXNzaWduKHsgaWQ6IGlkLCB0aW1lb3V0T2JqOiB0aW1lb3V0IH0sIHNuYWNrKTtcblxuICAgIGlmIChzbmFjay5hY3Rpb24pIHtcbiAgICAgIGNvbnN0IHRoYXQgPSB0aGlzO1xuICAgICAgY29uc3QgZmNuID0gc25hY2suYWN0aW9uLm9uQ2xpY2sgfHwgbmV3IEZ1bmN0aW9uKCk7XG4gICAgICBzbmFjay5hY3Rpb24ub25DbGljayA9ICgpID0+IHtcbiAgICAgICAgZmNuKGRhdGEpO1xuICAgICAgICB0aGF0LnJlbW92ZShpZCk7XG4gICAgICB9O1xuICAgIH1cblxuICAgIGlmIChzbmFjay5vbkFkZCkge1xuICAgICAgc25hY2sub25BZGQoZGF0YSk7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMub25BZGQpIHtcbiAgICAgIHRoaXMub25BZGQuZW1pdChkYXRhKTtcbiAgICB9XG5cbiAgICB0aGlzLnNuYWNrcy5wdXNoKGRhdGEpO1xuICB9XG5cbiAgcmVtb3ZlKGlkKSB7XG4gICAgY29uc3Qgc25hY2sgPSB0aGlzLnNuYWNrcy5maW5kKG9iaiA9PiBvYmouaWQgPT09IGlkKTtcblxuICAgIGlmIChzbmFjaykge1xuICAgICAgaWYgKHNuYWNrLm9uUmVtb3ZlKSB7XG4gICAgICAgIHNuYWNrLm9uUmVtb3ZlKHNuYWNrKTtcbiAgICAgIH1cblxuICAgICAgaWYgKHRoaXMub25SZW1vdmUpIHtcbiAgICAgICAgdGhpcy5vblJlbW92ZS5lbWl0KHNuYWNrKTtcbiAgICAgIH1cblxuICAgICAgaWYgKHNuYWNrLnRpbWVvdXRPYmopIHtcbiAgICAgICAgY2xlYXJUaW1lb3V0KHNuYWNrLnRpbWVvdXRPYmopO1xuICAgICAgfVxuICAgIH1cblxuICAgIHRoaXMuc25hY2tzID0gdGhpcy5zbmFja3MuZmlsdGVyKG9iaiA9PiBvYmouaWQgIT09IGlkKTtcbiAgfVxuXG4gIGNsZWFyKCkge1xuICAgIC8vIHRoaXMuc25hY2tzLmZvckVhY2goc25hY2sgPT4ge1xuICAgIC8vICAgdGhpcy5yZW1vdmUoc25hY2suaWQpO1xuICAgIC8vIH0pO1xuXG4gICAgdGhpcy5zbmFja3MgPSBbXTtcblxuICAgIGlmICh0aGlzLm9uQ2xlYXIpIHtcbiAgICAgIHRoaXMub25DbGVhci5lbWl0KHRydWUpO1xuICAgIH1cbiAgfVxuXG4gIHV1aWQoKSB7XG4gICAgLy8gdHNsaW50OmRpc2FibGU6bm8tYml0d2lzZVxuICAgIHJldHVybiAneHh4eHh4eHgteHh4eC00eHh4LXl4eHgteHh4eHh4eHh4eHh4Jy5yZXBsYWNlKC9beHldL2csIGZ1bmN0aW9uIChjKSB7XG4gICAgICBjb25zdCByID0gTWF0aC5yYW5kb20oKSAqIDE2IHwgMCwgdiA9IGMgPT09ICd4JyA/IHIgOiAociAmIDB4MyB8IDB4OCk7XG4gICAgICByZXR1cm4gdi50b1N0cmluZygxNik7XG4gICAgfSk7XG4gICAgLy8gdHNsaW50OmVuYWJsZTpuby1iaXR3aXNlXG4gIH1cblxuICBjYWxjVGV4dENvbG9yKGJhY2tncm91bmQpIHtcbiAgICBpZiAoIWJhY2tncm91bmQpIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGhleFRvUmdiKGhleCkge1xuICAgICAgY29uc3Qgc2hvcnRoYW5kUmVnZXggPSAvXiM/KFthLWZcXGRdKShbYS1mXFxkXSkoW2EtZlxcZF0pJC9pO1xuICAgICAgaGV4ID0gaGV4LnJlcGxhY2Uoc2hvcnRoYW5kUmVnZXgsIChtLCByLCBnLCBiKSA9PiB7XG4gICAgICAgIHJldHVybiByICsgciArIGcgKyBnICsgYiArIGI7XG4gICAgICB9KTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gL14jPyhbYS1mXFxkXXsyfSkoW2EtZlxcZF17Mn0pKFthLWZcXGRdezJ9KSQvaS5leGVjKGhleCk7XG4gICAgICByZXR1cm4gcmVzdWx0ID8ge1xuICAgICAgICByOiBwYXJzZUludChyZXN1bHRbMV0sIDE2KSxcbiAgICAgICAgZzogcGFyc2VJbnQocmVzdWx0WzJdLCAxNiksXG4gICAgICAgIGI6IHBhcnNlSW50KHJlc3VsdFszXSwgMTYpXG4gICAgICB9IDogbnVsbDtcbiAgICB9XG5cbiAgICBjb25zdCByZ2IgPSBoZXhUb1JnYihiYWNrZ3JvdW5kKTtcbiAgICBpZiAoIXJnYikge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuXG4gICAgY29uc3QgY29sb3IgPSBbcmdiLnIgLyAyNTUsIHJnYi5nIC8gMjU1LCByZ2IuYiAvIDI1NV07XG5cbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNvbG9yLmxlbmd0aDsgKytpKSB7XG4gICAgICBpZiAoY29sb3JbaV0gPD0gMC4wMzkyOCkge1xuICAgICAgICBjb2xvcltpXSA9IGNvbG9yW2ldIC8gMTIuOTI7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb2xvcltpXSA9IE1hdGgucG93KChjb2xvcltpXSArIDAuMDU1KSAvIDEuMDU1LCAyLjQpO1xuICAgICAgfVxuICAgIH1cblxuICAgIGNvbnN0IGwgPSAwLjIxMjYgKiBjb2xvclswXSArIDAuNzE1MiAqIGNvbG9yWzFdICsgMC4wNzIyICogY29sb3JbMl07XG5cbiAgICBpZiAobCA+IDAuMTc5KSB7XG4gICAgICByZXR1cm4gJyMwMDAnO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gJyNmZmYnO1xuICAgIH1cbiAgfVxufVxuIl19